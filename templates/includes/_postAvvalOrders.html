<form method="POST" action="">
  <fieldset onclick="notShow()" style="margin-bottom: 0; background: #fafafa; height: 82vh;">
    <legend>لطفا سفارش خود را ثبت  کنید:</legend>
    <table style="height: 77vh; display: inline-block; overflow-y: scroll;">
      <tbody>
        <tr>
          <td>
            <fieldset style="background: rgb(255,248,248);">
              <legend>اطلاعات</legend>
              <fieldset style="background: rgb(251,244,244);">
                <legend>فرستنده</legend>
                <div>
                  <span style="font-family: 'B-Roya'; font-size: 16px; color: red;">حقوقی<input id="s_is_legal" type="checkbox" name="s_is_legal" onchange="senderIsLegal()" value="true"/></span>
                  <input id="s_company_name" type="text" name="s_company_name" placeholder="نام شرکت" disabled />
                  <input id="s_national_company_code" type="text" name="s_national_company_code" placeholder="شناسه ملی شرکت" disabled />
                </div>
                <div>
                  <input id="s_first_name" type="text" name="s_first_name" onchange="validator('s_first_name', 'name')"  placeholder="نام" required />
                  <input id="s_last_name" type="text" name="s_last_name" onchange="validator('s_last_name', 'name')"  placeholder="نام خانوادگی" required />
                  <input id="s_cell_number" type="text" name="s_cell_number" onchange="validator('s_cell_number', 'number')"  placeholder="شماره موبایل" required/>
                  <input id="s_phone_number" type="text" name="s_phone_number" onchange="validator('s_phone_number', 'phone')" placeholder="تلفن ثابت" />
                  <input id="s_national_code" type="text" name="s_national_code" onchange="validator('s_national_code', 'nationalCode')" required placeholder="کد ملی" />
                </div>
                <div>
                  <label>آدرس</label>
                </div>
                <div id="add-srch" class="dropdown">
                  <div id="s-myDropdown" class="dropdown-content" style="width: max-content; position: unset; border-radius: 5px;">
                    <input type="text" placeholder="استان" id="s-myInput" autocomplete="nope" onclick="senderShow()" onkeyup="senderFilter()" size="15">
                    <div id="s-states" class="dropdown-content" style="display: none;">
                      {% for item in states %}
                        <a href="#" onclick="senderSearchStates('{{item[0]}}')">{{item[1]}}</a>
                      {% endfor %}
                    </div>
                  </div>
                </div>
                <div id="add-srch" class="dropdown">
                  <div id="s-myDropdown-city" class="dropdown-content" style="width: max-content; position: unset; border-radius: 5px;">
                    <input type="text" placeholder="شهر" id="s-myInput-city" autocomplete="nope" onclick="senderShowCities()" onkeyup="senderFilterCities()" size="15">
                    <div id="s-cities" class="dropdown-content" style="display: none;">
                    </div>
                  </div>
                </div>

                <select id="s-state" style="display: none;" name="s_stateCode" onchange='sCities()' required>
                  <option value="" disabled selected>استان</option>
                  {% for item in states %}
                    <option value="{{item[0]}}">{{item[1]}}</option>
                  {% endfor %}
                </select>
                <select id="s-city" style="display: none;" name="s_cityCode" required>
                  <option value="" disabled selected>شهر</option>
                </select>

                <div id="address">
                  <textarea name="s_address" placeholder="نشانی فرستنده"></textarea>
                </div>
                <div id="postal_code">
                  <input id="s_postal_code" type="text" name="s_postal_code" onchange="validator('s_postal_code', 'postalCode')" placeholder="کد پستی فرستنده" required />
                </div>
              </fieldset>
              <fieldset style="background: rgb(251,244,244);">
                <legend>گیرنده</legend>
                <div>
                  <span style="font-family: 'B-Roya'; font-size: 16px; color: red;">حقوقی<input id="r_is_legal" type="checkbox" name="r_is_legal" onchange="recieverIsLegal()" value="true"/></span>
                  <input id="r_company_name" type="text" name="r_company_name" placeholder="نام شرکت" disabled />
                  <input id="r_national_company_code" type="text" name="r_national_company_code" placeholder="شناسه ملی شرکت" disabled />
                </div>
                <div>
                  <input id="r_first_name" type="text" name="r_first_name" onchange="validator('r_first_name', 'name')" placeholder=" نام" required />
                  <input id="r_last_name" type="text" name="r_last_name" onchange="validator('r_last_name', 'name')" placeholder=" نام خانوادگی" required />
                  <input id="r_cell_number" type="text" name="r_cell_number" onchange="validator('r_cell_number', 'number')" placeholder=" شماره موبایل" required />
                  <input id="r_phone_number" type="text" name="r_phone_number" onchange="validator('r_phone_number', 'phone')" placeholder="تلفن ثابت" />
                  <input id="r_national_code" type="text" name="r_national_code" onchange="validator('r_national_code', 'nationalCode')" required placeholder="کد ملی" />
                </div>
                <div>
                  <label>آدرس</label>
                  <div id="add-srch" class="dropdown">
                    <div id="myDropdown" class="dropdown-content" style="width: max-content; position: unset; border-radius: 5px;">
                      <input type="text" placeholder="استان" id="myInput" autocomplete="nope" onclick="show()" onkeyup="filter()" size="15">
                      <div id="states" class="dropdown-content" style="display: none;">
                        {% for item in states %}
                          <a href="#" onclick="searchStates('{{item[0]}}')">{{item[1]}}</a>
                        {% endfor %}
                      </div>
                    </div>
                  </div>

                  <div id="add-srch" class="dropdown">
                    <div id="myDropdown-city" class="dropdown-content" style="width: max-content; position: unset; border-radius: 5px;">
                      <input type="text" placeholder="شهر" id="myInput-city" autocomplete="nope" onclick="showCities()" onkeyup="filterCities()" size="15">
                      <div id="cities" class="dropdown-content" style="display: none;">
                      </div>
                    </div>
                  </div>


                  <select id="state" style="display: none;" name="stateCode" onchange='cities()' required>
                    <option value="" disabled selected>استان</option>
                    {% for item in states %}
                      <option value="{{item[0]}}">{{item[1]}}</option>
                    {% endfor %}
                  </select>
                  <select id="city" style="display: none;" name="cityCode" required>
                    <option value="" disabled selected>شهر</option>
                  </select>
                </div>
                <div id="address">
                  <textarea name="address" placeholder="نشانی دقیق گیرنده" required></textarea>
                </div>
                <div id="postal_code">
                  <input id="r_postal_code" type="text" name="postal_code" onchange="validator('r_postal_code', 'postalCode')" placeholder="کد پستی گیرنده" required />
                </div>
              </fieldset>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <fieldset style="background: rgb(255,248,248);">
              <legend>اقلام سفارش</legend>
              <table id="order-0">
                <tbody style="height: 16vh;">
                  <tr>
                    <th>
                      <span>نام محصول</span>
                    </th>
                    <th>
                      <span class="font14">موجودی</span>
                    </th>
                    <th>
                      <span>تعداد</span>
                    </th>
                    <th>
                      <span>قیمت</span>
                    </th>
                    <th>
                      <span>درصد تخفیف</span>
                    </th>
                    <th>
                      <span>وزن (گرم)</span>
                    </th>
                    <th>
                      <span>عملیات</span>
                    </th>
                  </tr>
                  <tr id="row1" class="order-0">
                    <td>
                      <input id="product1" type="text" name="product_1" size="20" required/>
                    </td>
                    <td>
                      <span style="color: red;" id="exist_count1"></span>
                    </td>
                    <td>
                      <input id="count1" type="number" name="count_1" size="4" value="1" onchange="anyChange()" required/>
                    </td>
                    <td>
                      <input id="price1" type="number" name="price_1" size="6" onchange="priceChange()" required/>
                    </td>
                    <td>
                      <input id="discount1" type="number" name="discount_1" size="6" onchange="anyChange()" required/>
                    </td>
                    <td>
                      <input id="weight1" type="number" name="weight_1" size="6" onchange="anyChange()" required/>
                    </td>
                    <td>
                      <a href="javascript:addrow('row1','del')" title="حذف" class="del-box"> - </a>
                      <a href="javascript:addrow('row1', 'add')" title="افزودن" class="add-box"> + </a>
                    </td>
                  </tr>
                </tbody>
                <tfoot style="display: block;" class="tfoot">
                  <tr class="order-0">
                    <td>
                      <input type="text" name="sum" value="مجموع" size="25" disabled />
                    </td>
                    <td style="width: 200vw;"></td>
                    <td>
                      <input id="count-sum" type="number" name="count_sum" size="4" disabled/>
                    </td>
                    <td>
                      <input id="price-sum" type="number" name="price_sum" size="6" disabled/>
                    </td>
                    <td>
                      <input id="discount-sum" type="number" name="discount_sum" size="6" disabled/>
                    </td>
                    <td>
                      <input id="weight-sum" type="number" name="weight_sum" size="6" disabled/>
                    </td>
                    <td style="width: 200vw;"></td>
                  </tr>
                </tfoot>
              </table>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <fieldset style="background: rgb(255,248,248);">
              <legend>نوع منطقه سرویس</legend>
              <table id="order-1">
                <tr>
                  <td>
                    <label><input type="radio" name="ServiceZoneId" value="1" required/>داخله شهری<span style="color: green;"></span></label>
                  </td>
                  <td>
                    <label><input type="radio" name="ServiceZoneId" value="2" required checked />داخله بین شهری<span style="color: green;"></span></label>
                  </td>
                  <td>
                    <label><input type="radio" name="ServiceZoneId" value="3" required/>خارجه وارده<span style="color: green;"></span></label>
                  </td>
                  <td>
                    <label><input type="radio" name="ServiceZoneId" value="4" required/>خارجه صادره<span style="color: green;"></span></label>
                  </td>
                </tr>
              </table>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <fieldset style="background: rgb(255,248,248);">
              <legend>نوع مرسوله</legend>
              <table id="order-1">
                <tr>
                  <td>
                    <label><input type="radio" name="ParcelType" value="2" required checked />بسته<span style="color: green;"></span></label>
                  </td>
                  <td>
                    <label><input type="radio" name="ParcelType" value="1" required/>پاکات<span style="color: green;"></span></label>
                  </td>
                </tr>
              </table>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <fieldset style="background: rgb(255,248,248);">
              <legend>نوع سرویس</legend>
              <table id="order-1">
                <tr>
                  <td>
                    <label><input type="radio" name="serviceType" value="1" required checked />استاندارد<span id="sefareshi" style="color: green;"></span></label>
                  </td>
                  <td>
                    <label><input type="radio" name="serviceType" value="2" required/>اکسپرس<span id="pishtaz" style="color: green;"></span></label>
                  </td>
                  <td>
                    <label><input type="radio" name="serviceType" value="3" required/>خارجه<span style="color: green;"></span></label>
                  </td>
                </tr>
              </table>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <fieldset style="background: rgb(255,248,248);">
              <legend>شیوه پرداخت</legend>
              <table id="order-1">
                <tr>
                  <td>
                    <label><input id="payType1" type="radio" name="payType" onchange="codChange()" disabled value="1" checked />پرداخت در محل</label>
                  </td>
                  <td>
                    <label style="color: red; font-weight: bold;"><input type="checkbox" id="rad" name="rad" value="true" onchange="rentalAtDest()" disabled />کرایه در مقصد</label>
                  </td>
                  <td>
                    <label style="color: red; font-weight: bold;"><input type="checkbox" id="cgd" name="cgd" value="true" onchange="productPriceAtDest()" disabled />هزینه کالا در مقصد</label>
                  </td>
                  <td>
                    <label><input id="payType2" type="radio" name="payType" onchange="onlineChange()" checked="true" value="2"/>پرداخت آنلاین</label>
                  </td>
                </tr>
              </table>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <fieldset style="background: rgb(255,248,248); height: 15vh;">
              <legend>سایر اطلاعات</legend>
              <table id="order-2">
                <tbody style="height: 12vh;">
                  <tr>
                    <td style="display: none;">
                      <input id="product-price" type="number"/>
                    </td>
                    <td style="display: none;">
                      <input id="onChange-product-price" type="number"/>
                    </td>
                    <td style="display: none;">
                      <input id="first-wage" value="0" type="number"/>
                    </td>
                    <td style="display: none;">
                      <input id="pishtaz-input" type="number"/>
                    </td>
                    <td style="display: none;">
                      <input id="sefareshi-input" type="number"/>
                    </td>
                    <td>
                      <label>قیمت نهایی سرویس (ریال):</label>
                      <input id="wage" type="number" name="wage" value="0" onchange="wageOnChange()" size="6"  required/>
                    </td>
                    <td>
                      <label>هزینه کارتن (ریال):</label>
                      <input id="carton" type="number" name="carton" value="0" onchange="wageOnChange()" size="6" required/>
                    </td>
                    <td>
                      <label>هزینه بسته بندی (ریال):</label>
                      <input id="packing" type="number" name="packing" value="0" onchange="wageOnChange()" size="6" required/>
                    </td>
                    <td>
                      <label>هزینه جمع آوری (ریال):</label>
                      <input id="gathering" type="number" name="gathering" value="0" onchange="wageOnChange()" size="6" required/>
                    </td>
                    <td>
                      <label>ابعاد بسته:</label>
                      <select id="dimension" name="dimension" dir="ltr" required>
                        <option value="0">سایز نیم</option>
                        <option value="1">سایز 1</option>
                        <option value="2">سایز 2</option>
                        <option value="3">سایز 3</option>
                        <option value="4">سایز 4</option>
                        <option value="5">سایز 5</option>
                        <option value="6">سایز 6</option>
                        <option value="7">سایز 7</option>
                        <option value="8">سایز بزرگ</option>
                      </select>
                    </td>
                    <td>
                      <label><input type="checkbox" name="without_ck" value="1"/>فاقد وجه نقد و اشیاء قیمتی</label>
                    </td>
                  </tr>
                </tbody>
              </table>
            </fieldset>
          </td>
        </tr>
        <tr>
          <td>
            <input style="font-size: 17px; font-family: BNazanin;" type="submit" value="ثبت سفارش" />
          </td>
        </tr>
      </tbody>
    </table>
  </fieldset>
</form>

<script type="text/javascript">
  var show_flag = 0;
  var q=1;
  var i_list = ["row1"];
  var Weight = 0;
  var Price = 0;
  var Count = 0;
  var Discount = 0;
  var wage_flag = 1;
  function addrow(id_name, action) {
    var original = document.getElementById(id_name);
    var clone = original.cloneNode(true); // "deep" clone
    if (action == 'add'){
      clone.id = "row" + ++q;
      i_list.push(clone.id);
      for (ii=0; ii<2; ii++) {
        var ex = "exist_count"+id_name.substring(3, id_name.length);
        clone.innerHTML = clone.innerHTML.replace(ex, "exist_count"+q);
        var p = "price"+id_name.substring(3, id_name.length);
        clone.innerHTML = clone.innerHTML.replace(p, "price"+q);
        var d = "discount"+id_name.substring(3, id_name.length);
        clone.innerHTML = clone.innerHTML.replace(d, "discount"+q);
        var w = "weight"+id_name.substring(3, id_name.length);
        clone.innerHTML = clone.innerHTML.replace(w, "weight"+q);
        var pr = "product"+id_name.substring(3, id_name.length);
        clone.innerHTML = clone.innerHTML.replace(pr, "product"+q);
      }
      var title = "product_"+id_name.substring(3, id_name.length);
      clone.innerHTML = clone.innerHTML.replace(title, "product_"+q);
      var cou = "count_"+id_name.substring(3, id_name.length);
      clone.innerHTML = clone.innerHTML.replace(cou, "count_"+q);
      var pri = "price_"+id_name.substring(3, id_name.length);
      clone.innerHTML = clone.innerHTML.replace(pri, "price_"+q);
      var dis = "discount_"+id_name.substring(3, id_name.length);
      clone.innerHTML = clone.innerHTML.replace(dis, "discount_"+q);
      var we = "weight_"+id_name.substring(3, id_name.length);
      clone.innerHTML = clone.innerHTML.replace(we, "weight_"+q);
      clone.innerHTML = clone.innerHTML.replace(id_name, clone.id);
      var c = "count"+id_name.substring(3, id_name.length);
      clone.innerHTML = clone.innerHTML.replace(c, "count"+q);
      var str = "row"+id_name.substring(3, id_name.length);
      clone.innerHTML = clone.innerHTML.replace(str, "row"+q);
      original.parentNode.appendChild(clone);
      document.getElementById("exist_count"+q).innerHTML = "";
    } else {
      if (i_list.length > 1) {
        original.parentNode.removeChild(original);
        i_list.splice(i_list.indexOf(id_name), 1);
        anyChange();
      }
    }
  }

  function cities(){
    var state_code = document.getElementById("state").value;
    var city = document.getElementById("city");

    if (state_code) {
      const xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {

              var json = JSON.parse(this.responseText);


              city.options.length = 1;

              for (var i = 0; i < json.Name.length; i++) {
                  var opt = document.createElement('option');
                  opt.value = json.Code[i];
                  opt.innerHTML = json.Name[i];
                  city.appendChild(opt);
              }
         }
      }
      xhr.open('GET', '/postAvvalAjax?code=' + state_code, true);
      xhr.send(); 
    } else {
      city.options.length = 1;
    }
  }

  function sCities(){
    var state_code = document.getElementById("s-state").value;
    var city = document.getElementById("s-city");

    if (state_code) {
      const xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {

              var json = JSON.parse(this.responseText);


              city.options.length = 1;

              for (var i = 0; i < json.Name.length; i++) {
                  var opt = document.createElement('option');
                  opt.value = json.Code[i];
                  opt.innerHTML = json.Name[i];
                  city.appendChild(opt);
              }
         }
      }
      xhr.open('GET', '/postAvvalAjax?code=' + state_code, true);
      xhr.send(); 
    } else {
      city.options.length = 1;
    }
  }

  function getDeliveryPrice() {
    var c = document.getElementById('city').value;
    if (document.getElementById('payType1').checked) {
      var pType = document.getElementById('payType1').value;
    } else if (document.getElementById('payType2').checked) {
      var pType = document.getElementById('payType2').value;
    }
    const xhr2 = new XMLHttpRequest();
    xhr2.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {

          var json = JSON.parse(this.responseText);
          document.getElementById('sefareshi').innerHTML = ' (' +json.sefareshi+ ' ریال)';
          document.getElementById('pishtaz').innerHTML = ' (' +json.pishtaz+ ' ریال)';
          document.getElementById('sefareshi-input').value = json.sefareshi;
          document.getElementById('pishtaz-input').value = json.pishtaz;

          //if (document.getElementById('rad').checked) {
            //rentalAtDest();
          //}
       }
    }
    xhr2.open('GET', '/postAvval-price-ajax?weight='+Weight+'&price='+Price+'&city='+c+'&pType='+pType, true);
    xhr2.send();
  }

  function refreshWeightPrice() {
    w = 0;
    p = 0;
    c = 0;
    d = 0;

    for (var cc = 0; cc < i_list.length; cc++) {
      index = i_list[cc].substring(3, i_list[cc].length);
      //alert(index)
      if (parseInt(document.getElementById('weight'+index).value)) {

        p_count = parseInt(document.getElementById('count'+index).value);
        p_discount = parseInt(document.getElementById('discount'+index).value);
        p_price = parseInt(document.getElementById('price'+index).value);
        
        w = w + (p_count * parseInt(document.getElementById('weight'+index).value));
        c = c + p_count;
        p = p + (p_count * (p_price - (p_price*(p_discount/100))));
        d = d + (p_count * p_discount);
        
      }
    }
    Weight = w;
    Price = p;
    Count = c;
    Discount = d;
    document.getElementById('count-sum').value = Count;
    document.getElementById('price-sum').value = Price;    
    document.getElementById('weight-sum').value = Weight;
    document.getElementById('discount-sum').value = Discount;
    wageCalculator(Weight);
    return Price;
  }

  function anyChange() {
    refreshWeightPrice();
    getDeliveryPrice();
  }

  function validator(id_name, type) {
    var data = document.getElementById(id_name).value;
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {

          var json = JSON.parse(this.responseText);
          if (!json.result) {
            document.getElementById(id_name).value = "";
            document.getElementById(id_name).focus();
            if (type == 'name') {
              alert('خطا !\nنام و نام خانوادگی باید فقط شامل حروف فارسی و لاتین باشند!');
            } else if (type == 'nationalCode') {
              alert('خطا !\nکد ملی به درستی وارد نشده است!');
            } else if (type == 'postalCode') {
              alert('خطا !\nکد پستی به درستی وارد نشده است!');
            } else {
              alert('خطا !\nشماره موبایل به درستی وارد نشده است!');
            }
            
          }
       }
    }
    xhr.open('GET', '/validator-ajax?data='+data+'&type='+type, true);
    xhr.send();
  }

  function show() {
    show_flag = 1;
    document.getElementById("states").style.display = 'block';
    document.getElementById('cities').style.display = 'none';
    document.getElementById("cities").innerHTML = "";
    document.getElementById("myInput-city").value = "";
  }

  function senderShow() {
    show_flag = 1;
    document.getElementById("s-states").style.display = 'block';
    document.getElementById('s-cities').style.display = 'none';
    document.getElementById("s-cities").innerHTML = "";
    document.getElementById("s-myInput-city").value = "";
  }

  function showCities() {
    show_flag = 1;
    document.getElementById("cities").style.display = 'block';
  }

  function senderShowCities() {
    show_flag = 1;
    document.getElementById("s-cities").style.display = 'block';
  }

  function senderIsLegal() {
    var check = document.getElementById('s_is_legal').checked;
    if (check == true) {
      document.getElementById('s_company_name').disabled = false;
      document.getElementById('s_company_name').required = true;
      document.getElementById('s_national_company_code').disabled = false;
      document.getElementById('s_national_company_code').required = true;
      document.getElementById('s_national_code').required = false;
    } else if (check == false) {
      document.getElementById('s_company_name').disabled = true;
      document.getElementById('s_company_name').required = false;
      document.getElementById('s_national_company_code').disabled = true;
      document.getElementById('s_national_company_code').required = false;
      document.getElementById('s_national_code').required = true;
    }
  }

  function recieverIsLegal() {
    var check = document.getElementById('r_is_legal').checked;
    if (check == true) {
      document.getElementById('r_company_name').disabled = false;
      document.getElementById('r_company_name').required = true;
      document.getElementById('r_national_company_code').disabled = false;
      document.getElementById('r_national_company_code').required = true;
      document.getElementById('r_national_code').required = false;
    } else if (check == false) {
      document.getElementById('r_company_name').disabled = true;
      document.getElementById('r_company_name').required = false;
      document.getElementById('r_national_company_code').disabled = true;
      document.getElementById('r_national_company_code').required = false;
      document.getElementById('r_national_code').required = true;
    }
  }

  function notShow() {
    if (!show_flag) {
      document.getElementById("states").style.display = 'none';
      document.getElementById("cities").style.display = 'none';
      document.getElementById("s-states").style.display = 'none';
      document.getElementById("s-cities").style.display = 'none';
    }
    show_flag = 0;
  }

  function filter() {
    var input, filter, ul, tr, a, i;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    div = document.getElementById("myDropdown");
    a = div.getElementsByTagName("a");
    for (i = 0; i < a.length; i++) {
      txtValue = a[i].textContent || a[i].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        a[i].style.display = "";
      } else {
        a[i].style.display = "none";
      }
    }
  }

  function filterCities() {
    var input, filter, ul, tr, a, i;
    input = document.getElementById("myInput-city");
    filter = input.value.toUpperCase();
    div = document.getElementById("myDropdown-city");
    a = div.getElementsByTagName("a");
    for (i = 0; i < a.length; i++) {
      txtValue = a[i].textContent || a[i].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        a[i].style.display = "";
      } else {
        a[i].style.display = "none";
      }
    }
  }

  function senderFilter() {
    var input, filter, ul, tr, a, i;
    input = document.getElementById("s-myInput");
    filter = input.value.toUpperCase();
    div = document.getElementById("s-myDropdown");
    a = div.getElementsByTagName("a");
    for (i = 0; i < a.length; i++) {
      txtValue = a[i].textContent || a[i].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        a[i].style.display = "";
      } else {
        a[i].style.display = "none";
      }
    }
  }

  function senderFilterCities() {
    var input, filter, ul, tr, a, i;
    input = document.getElementById("s-myInput-city");
    filter = input.value.toUpperCase();
    div = document.getElementById("s-myDropdown-city");
    a = div.getElementsByTagName("a");
    for (i = 0; i < a.length; i++) {
      txtValue = a[i].textContent || a[i].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        a[i].style.display = "";
      } else {
        a[i].style.display = "none";
      }
    }
  }

  function searchStates(code) {
    var city = document.getElementById("city");
    var div = document.getElementById("cities");
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById('states').style.display = 'none';
          var json = JSON.parse(this.responseText);

          document.getElementById('myInput').value = json.stateName
          city.options.length = 1;
          //alert(city.options.lenght);

          for (var i = 0; i < json.Name.length; i++) {
            var a = document.createElement('a');
            a.innerHTML = json.Name[i];
            a.id = "a"+i;
            a.href = '#';
            div.appendChild(a);
            (function(name, code){
            a.addEventListener("click", function() {
              document.getElementById('cities').style.display = 'none';
              document.getElementById('myInput-city').value = name;
              document.getElementById('state').value = json.stateCode;
              var opt = document.createElement('option');
              opt.value = code;
              opt.innerHTML = name;
              city.appendChild(opt);
              city.value = code;
            }, false);})(json.Name[i], json.Code[i]);
          }
       } else {
          city.options.length = 1;
       }
    }
    xhr.open('GET', '/postAvvalAjax?code=' + code, true);
    xhr.send();
  }

  function senderSearchStates(code) {
    var city = document.getElementById("s-city");
    var div = document.getElementById("s-cities");
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById('s-states').style.display = 'none';
          var json = JSON.parse(this.responseText);

          document.getElementById('s-myInput').value = json.stateName
          city.options.length = 1;
          //alert(city.options.lenght);

          for (var i = 0; i < json.Name.length; i++) {
            var a = document.createElement('a');
            a.innerHTML = json.Name[i];
            a.id = "a"+i;
            a.href = '#';
            div.appendChild(a);
            (function(name, code){
            a.addEventListener("click", function() {
              document.getElementById('s-cities').style.display = 'none';
              document.getElementById('s-myInput-city').value = name;
              document.getElementById('s-state').value = json.stateCode;
              var opt = document.createElement('option');
              opt.value = code;
              opt.innerHTML = name;
              city.appendChild(opt);
              city.value = code;
            }, false);})(json.Name[i], json.Code[i]);
          }
       } else {
          city.options.length = 1;
       }
    }
    xhr.open('GET', '/postAvvalAjax?code=' + code, true);
    xhr.send();
  }

  function wageCalculator(weight) {
    var cgd = document.getElementById('cgd').checked;
    var rad = document.getElementById('rad').checked;
    var cod = document.getElementById('payType1').checked;
    var online = document.getElementById('payType2').checked;
    if (cgd) {
      var service = 'cgd';
    } else if (rad) {
      var service = 'rad';
    } else if (online) {
      var service = 'online';
    } else if (cod) {
      var service = 'cod';
    }
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var json = JSON.parse(this.responseText);
          if (wage_flag) {
            document.getElementById('wage').value = json.wage;
          }
          document.getElementById('first-wage').value = json.wage;
          if (rad) {
            var wage = parseInt(document.getElementById('wage').value);
            var packing = parseInt(document.getElementById('packing').value);
            var carton = parseInt(document.getElementById('carton').value);
            var gathering = parseInt(document.getElementById('gathering').value);
            var sum = wage+packing+carton+gathering;
            document.getElementById('price1').value = sum;
            document.getElementById('price-sum').value = sum;
          }
       }
    }
    xhr.open('GET', '/wage-calculator?weight='+weight+'&service='+service, true);
    xhr.send();
  }

  function wageOnChange() {
    var cgd = document.getElementById('cgd').checked;
    var rad = document.getElementById('rad').checked;
    var cod = document.getElementById('payType1').checked;
    var online = document.getElementById('payType2').checked;
    var post_free = document.getElementById('free').checked;
    var wage = parseInt(document.getElementById('wage').value);
    var packing = parseInt(document.getElementById('packing').value);
    var carton = parseInt(document.getElementById('carton').value);
    var gathering = parseInt(document.getElementById('gathering').value);
    var product_price = parseInt(document.getElementById('product-price').value);
    var sum = wage+packing+carton+gathering;
    if (rad) {
      rentalAtDest();
    }
    else if (cgd) {
      productPriceAtDest();
    }
    else if ((cod) & (!post_free)) {
      document.getElementById('price1').value = product_price + sum;
      document.getElementById('price-sum').value = product_price + sum;
      document.getElementById('onChange-product-price').value = product_price + sum;
      anyChange();
    }
    else if ((online) & (!post_free)) {
      document.getElementById('price1').value = product_price;
      document.getElementById('price-sum').value = product_price + sum;
      document.getElementById('onChange-product-price').value = product_price;
      anyChange();
    }
    if (wage != parseInt(document.getElementById('first-wage').value)) {
      wage_flag = 0;
    }
  }

  function priceChange() {
    var price = refreshWeightPrice();
    getDeliveryPrice();
    document.getElementById('product-price').value = price;
  }
</script>