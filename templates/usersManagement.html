{% extends 'layout.html' %}

{% include 'includes/_logo.html' %}

{% block body %}
	<div class="container">
		{% include 'includes/_tab.html' %}
  		<main class="card">
			<div class="dropdown-content-inventory">
				<input type="text" class="navbar-link invent-search" id="myInput-inventory" onkeyup="filter()" size="25">
			</div>
			{% if session['role'] != 'vendor_admin' %}
				{% include 'includes/_usersManagementTab.html' %}
			{% endif %}
			{% if (sub_item == 'Users') or (sub_item == 'office') or (sub_item == 'api') %}
				{% if session['role'] != 'vendor_admin' %}
				<fieldset class="fieldset" style="margin-top: 1vh; height: 75vh;">
				{% else %}
				<fieldset class="fieldset" style="margin-top: 3vh; height: 80vh;">
				{% endif %}
					<legend>مدیریت کاربران:</legend>
					<table id="inventory">
						<thead>
							<tr style="background: yellow;">
								<th style="width: 4vw;">
									<span>ردیف</span>
								</th>
								<th>
									<span>نام و نام خانوادگی</span>
								</th>
								<th>
									<span>نام کاربری</span>
								</th>
								<th>
									<span>سطح کاربری</span>
								</th>
								<th style="width: 14vw;">
									<span>پست الکترونیکی</span>
								</th>
								<th>
									<span>تلفن</span>
								</th>
								<th>
									<span>تاریخ ایجاد</span>
								</th>
								<th>
									<span>اقدام</span>
								</th>
								<th style="width: 1vw;"></th>
							</tr>
						</thead>
						<tbody id="myDropdown" style="height: 71vh;">
							{% for rec in data %}
							{% if session['role'] != 'vendor_admin' %}
								{% if session['username'] == rec['username'] %}
								<tr id="rows" class="border-bottom" onclick="usersDetail('{{rec['username']}}')" style="background: #81fc81;">
								{% else %}
								<tr id="rows" class="border-bottom" onclick="usersDetail('{{rec['username']}}')">
								{% endif %}
							{% else %}
								{% if session['username'] == rec['username'] %}
								<tr class="border-bottom" style="background: #81fc81;">
								{% else %}
								<tr id="rows" class="border-bottom" onclick="usersDetail('{{rec['username']}}')">
								{% endif %}
							{% endif %}
									<td style="width: 4vw;">
										<span>{{loop.index}}</span>
									</td>
									<td>
										<span>{{rec['name']}}</span>
									</td>
									<td>
										<span class="font14">{{rec['username']}}</span>
									</td>
									{% if ('ایجاد کاربری' not in rec['access']) and (rec['role'] == 'مدیر فروشگاه' ) %}
										{% if session['role'] == 'vendor_admin' %}
										<td>
											<a title="{{('\n'.join(rec['access']))}}"><span>کاربر</span></a>
										</td>
										{% else %}
										<td>
											<a title="{{('\n'.join(rec['access']))}}"><span>کاربر فروشگاه</span></a>
										</td>
										{% endif %}
									{% else %}
										<td>
											<a title="{{('\n'.join(rec['access']))}}"><span>{{rec['role']}}</span></a>
										</td>
									{% endif %}
									<td style="width: 14vw;">
										<span class="font14">{{rec['email']}}</span>
									</td>
									<td>
										<span>{{rec['phone']}}</span>
									</td>
									<td>
										<span>{{rec['created_date']}}</span>
									</td>
									{% if session['username'] == rec['username'] %}
										<td id="no-action" onclick="tdOnclick()">
							              <span style="float: unset; margin: auto;" id="delete"></span>
							            </td>
							        {% else %}
							        	<td id="no-action" onclick="tdOnclick()">
							              <a href="/delete-user/{{rec['username']}}" title="حذف کاربر"><span style="float: unset; margin: auto;" id="delete"></span></a>
							            </td>
							        {% endif %}
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</fieldset>
			{% elif sub_item == 'vendors' %}
				<fieldset class="fieldset" style="margin-top: 1vh; height: 75vh;">
					<legend>مدیریت کاربران:</legend>
					<table id="inventory">
						<thead>
							<tr style="background: yellow;">
								<th style="width: 4vw;">
									<span>ردیف</span>
								</th>
								<th>
									<span>نام و نام خانوادگی</span>
								</th>
								<th>
									<span class="font14">نام کاربری</span>
								</th>
								<th>
									<span>سطح کاربری</span>
								</th>
								<th>
									<span>نام فروشگاه</span>
								</th>
								<th>
									<span>تلفن</span>
								</th>
								<th>
									<span>شماره حساب</span>
								</th>
								<th>
									<span>نام صاحب حساب</span>
								</th>
								<th>
									<span>تاریخ ایجاد</span>
								</th>
								<th>
									<span>اقدام</span>
								</th>
								<th style="width: 1vw;"></th>
							</tr>
						</thead>
						<tbody id="myDropdown" style="height: 71vh;">
							{% for rec in data %}
								<tr id="rows" class="border-bottom" onclick="usersDetail('{{rec['username']}}')">
									<td style="width: 4vw;">
										<span>{{loop.index}}</span>
									</td>
									<td>
										<span>{{rec['name']}}</span>
									</td>
									<td>
										<span>{{rec['username']}}</span>
									</td>
									{% if 'ایجاد کاربری' in rec['access'] %}
										<td>
											<a title="{{('\n'.join(rec['access']))}}"><span>{{rec['role']}}</span></a>
										</td>
									{% else %}
										<td>
											<a title="{{('\n'.join(rec['access']))}}"><span>کاربر</span></a>
										</td>
									{% endif %}
									<td>
										<span>{{rec['vendor_name']}}</span>
									</td>
									<td>
										<span>{{rec['phone']}}</span>
									</td>
									<td>
										<span>{{rec['account_number']}}</span>
									</td>
									<td>
										<span>{{rec['account_holder']}}</span>
									</td>
									<td>
										<span>{{rec['created_date']}}</span>
									</td>
									<td id="no-action" onclick="tdOnclick()">
						              <a href="/delete-user/{{rec['username']}}" title="حذف کاربر"><span style="float: unset; margin: auto;" id="delete"></span></a>
						            </td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</fieldset>
			{% endif %}
		</main>
	</div>

	<script type="text/javascript">
		function filter() {
			var input, value, tr, div, i;
			input = document.getElementById("myInput-inventory");
			value = input.value.toUpperCase();
			div = document.getElementById("myDropdown");
			tr = div.getElementsByTagName("tr");
			if (isNaN(value)) {
				for (i = 0; i < (tr.length); i++) {
					span = tr[i].getElementsByTagName("span");
					txtValue = span[1].textContent;
					if (txtValue.toUpperCase().indexOf(value) > -1) {
						tr[i].style.display = "";
					} else {
						txtValue = span[2].textContent;
						if (txtValue.toUpperCase().indexOf(value) > -1) {
							tr[i].style.display = "";
						} else {
							txtValue = span[3].textContent;
							if (txtValue.toUpperCase().indexOf(value) > -1) {
								tr[i].style.display = "";
							} else {
								txtValue = span[4].textContent;
								if (txtValue.toUpperCase().indexOf(value) > -1) {
									tr[i].style.display = "";
								} else {
									txtValue = span[7].textContent;
									if (txtValue.toUpperCase().indexOf(value) > -1) {
										tr[i].style.display = "";
									} else {
										tr[i].style.display = "none";
									}
								}
							}
						}
					}
				}
			} else {
				for (i = 0; i < (tr.length); i++) {
					span = tr[i].getElementsByTagName("span");
					txtValue = span[5].textContent;
					if (txtValue.toUpperCase().indexOf(value) > -1) {
						tr[i].style.display = "";
					} else {
						txtValue = span[6].textContent;
						txtValue = txtValue.replace(/\s/g, '');
						if (txtValue.toUpperCase().indexOf(value) > -1) {
							tr[i].style.display = "";
						} 
						else {
							txtValue = span[6].textContent;
							txtValue = txtValue.replace(/\s/g, '');
							if (txtValue.toUpperCase().indexOf(value) > -1) {
								tr[i].style.display = "";
							} else {
								tr[i].style.display = "none";
							}
						}
					}
				}
				span = tr[0].getElementsByTagName("span");
				txtValue = span[5].textContent;
				txtValue = txtValue.replace(/\s/g, '');
				//alert(txtValue)
			}
		}

		function reverse_date_1(s) {
			s = s.split("/").reverse().join("/");
			return s;
		}

		function reverse_date_2(s) {
			s = s.split(" / ").reverse().join(" / ");
			return s;
		} 

		function reverse_time(s) {
			s = s.split(":").reverse().join(":");
			return s;
		}

		function usersDetail(username) {
			window.open("/users-detail/"+username, 'User Details', 'width=950,height=500,top=100,left=300');
		}

		function tdOnclick() {
			event.cancelBubble=true;
		}
	</script>
{% endblock %}